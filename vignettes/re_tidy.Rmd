---
title: "Report Exercise 4.6"
author: "Francesco Lucano"
date: "`r Sys.Date()`"
output: html_document
---

# Introduction

Here I briefly describe the purpose of this report.

### Setup
```{r setup, include=FALSE}
# Load necessary packages
library(dplyr)    
library(readr)      
library(lubridate)  
library(knitr)
library(here)

# Read the CSV file
soil_data <- readr::read_delim(
  here("data", "soil_organic_matter.csv"),
  delim = ";"
)
```

### Calculate log-response ratio
```{r}
# We calculate the log-response ratio for each observation
soil_data <- soil_data %>%
  mutate(log_rr = log(mean_increased_CO2 / mean_ambient_CO2))
```

### Phase classification
```{r}
# We classify observations into phases based on years
soil_data <- soil_data %>%
  mutate(phase = case_when(
    Time_years < 3  ~ "early",
    Time_years <= 6 ~ "mid",
    TRUE            ~ "late"
  ))
```

### Aggregation of log-response ration by phase
```{r}
# we aggregate log-response ratios by phase by taking their mean
phase_summary <- soil_data %>%
  group_by(phase) %>%
  summarise(mean_log_rr = mean(log_rr, na.rm = TRUE),
            .groups = "drop")

# Display the result as a formatted table
kable(phase_summary, caption = "Mean Log-Response Ratio by Phase")
```

### Discussion